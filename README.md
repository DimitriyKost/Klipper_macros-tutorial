# Учебник по макросам дл Klippera
Makros Klipper Tutorial - https://klipper.discourse.group/t/macro-creation-tutorial/30/2


## Часть 1: Основные концепции программирования

Макросы Klipper довольно мощные, но в то же время могут быть ограничены в своей
области применения. Идея макросов заключается в том, чтобы иметь возможность принимать некоторые базовые решения и действовать
в соответствии с ними, заменяя различные значения другими значениями. Однако, чтобы понять макросы,
мы должны сначала понять некоторые основы программирования

### Что такое функция?

Функция - это фрагмент кода, который выдает выходные данные на основе входных данных. Обычно
решения принимаются внутри функции с помощью выражений, которые определяют, что должна делать
функция. Функции также могут называться методами, подпрограммами, процедурами.
Все они делают в основном одно и то же: берут блок кода и присваивают ему имя
, чтобы его можно было повторно использовать для создания выходных данных на основе входных данных.

### Что такое литерал?

Литерал - это значение, которое фактически жестко запрограммировано и не может быть изменено
на протяжении выполнения программы. Например, целочисленное значение 42 является
литералом. Значение 42 буквально 42.

### Что такое комментарий?

Комментарий предназначен для того, чтобы человек, пишущий код, оставлял
заметки для себя или кого-либо еще, если он вернется и попытается понять
код позже. Комментарии обозначаются специальным символом или набором символов,
специфичных для каждого языка программирования. В случае конфигурационных файлов Klipper и
макросов для обозначения комментария используются два таких символа. # и ; . Когда
любой из них появляется в строке, все, что находится после них, будет проигнорировано.

	#Move the toolhead to the middle of the bed
	G1 X150 Y150
	
	#Move the toolhead up slightly
	G1 Z1
Комментарии также могут быть полезны при отладке или изменении кода. Если у вас
есть фрагмент кода, который, возможно, работает неправильно, или вы хотите попробовать его переделать
сделайте что-нибудь еще, но не хотите удалять исходный фрагмент, если это не сработает
работая, вы можете “закомментировать” этот фрагмент кода

	#Move the toolhead to the middle of the bed
	#G1 X150 Y150
	
	#Move the toolhead up slightly
	G1 Z1
В приведенном выше примере только что прокомментированная строка будет проигнорирована, когда придет время
время выполнения макроса.

### Что такое переменная?

Переменная - это значение, которое может изменяться на протяжении выполнения программы.
Переменные обычно представлены именами или буквами. Имя связано
со значением, потому что значение может изменяться. Когда на имя переменной ссылаются
во время выполнения блока кода, имя заменяется на
значение переменной во время выполнения выражения. Итак, если мы возьмем
наш литерал 42 и присвоим его переменной, вызываемой e всякий раз, когда e на
ссылаются, будет использоваться значение 42.

### Что такое задание?

Присвоение значения переменной выполняется путем присваивания. Это может быть буквальное значение,
значение другой переменной или результат выражения. Присвоение выполняется путем
установки переменной, равной значению. В синтаксисе Jinja2 это делается с помощью

	{ set x = 42 }
 
### Что такое выражение?

Выражение - это команда программирования, которая что-то делает. Простым примером
может быть команда gcode. M105 это выражение gcode, которое сообщает о различных
температурах. Присвоение переменной также является выражением. Сравнение
двух значений является выражением. Проще говоря, выражение - это фрагмент кода,
который выдает результат или значение.

### Что такое объект?

Объект представляет собой набор переменных, состояний, функций и, возможно, большего количества
объектов. Объекты используются для организации сущностей в программе и доступа к ним. Для
например, в Klipper macros есть printer объект, к которому прикреплен другой
объект “веер”. У вентилятора есть переменная “speed”, которая используется
как для получения, так и для установки скорости вентилятора. Чтобы получить скорость вентилятора, можно использовать

	printer.fan.speed 
Что такое параметр?

Параметр - это значение, которое используется в качестве входных данных для выполнения
функции. В gcode функцией будет команда gcode, а
параметрами будут положения осей и скорости.

	G1 X100 Y24 Z1 F2000
В других языках программирования, таких как python, функции представлены именем
а параметры заключены в круглые скобки после имени.

	action_respond_info("String Literal")
### Что такое условное обозначение?

Аналогично, выражения также могут оценивать две вещи. Условные выражения отвечают на
Yes или No, True илиFalse, 1 или 0 задавайте вопрос, оценивая одну переменную или литерал
по сравнению с другой переменной или литералом. Это “булева” логика, и она лежит в
основе всего программирования.

	Is 15 equal to 12? 
	False

	Is EXTRUDER_TEMP > 100?
	True
Аналогично, функции могут возвращать значение после выполнения, и это значение также можно
сравнивать в выражении.

Там говорится, что у вас есть функция, вызываемая EXTRUDER_PERCENT_TO_TARGET() и она принимает
два параметра. Она возвращает процентное соотношение CURRENT_TEMP к TARGET_TEMP
Is EXTRUDER_PERCENT_TO_TARGET( CURRENT_TEMP, TARGET_TEMP ) > 70? False
Что такое макрос?

Макрос - это сохраненный набор команд, которые могут быть вызваны из одной
команды gcode. Макросы могут вызывать другие макросы или даже самих себя. Макросы можно
рассматривать как функции. По сути, макрос klipper - это
функция.

### Что такое Jinja?

Jinja - это движок для python (основного языка Klipper), который может
брать блок текста и считывать из него элементы программирования. В случае
макросов gcode эти программные элементы применяются в качестве шаблона команды.

Шаблон команды можно рассматривать как абзац из книги "Заполните пробелы".
Например, Mad Libs встречается с Choose Your Own Adventure. Когда вызывается макрос gcode,
полностью считывается и оценивается шаблон команды. gcode, который
передается обратно в klipper, является результатом любых решений, которые были приняты
внутри этого макроса.

### Что такое отложенный gcode?

Отложенный gcode - это макрос, который нельзя вызвать напрямую, но вместо этого вызывается
и выполняется по таймеру с заданным интервалом. Отложенный gcode может выполняться один или
неоднократно.

